{% extends 'layouts/dashboard/base.html' %}
{% load static %}

{% block content %}

<div class="col-md-12">
    <form method="post" enctype="multipart/form-data" id="flight_report_form">
        {% csrf_token %}
        <div class="card">
            <div class="card-header card-header-rose card-header-icon">
                <div class="card-icon">
                    <i class="material-icons">&#xE905;</i>
                </div>
                <div class="card-text">
                    <h4 class="card-title">VUELO</h4>
                    {% if form.non_field_errors %}
                    <ul class="errorlist">
                        {% for error in form.non_field_errors %}
                        <li><strong class="text-danger">{{ error|escape }}</strong></li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {% if errors %}
                    <ul class="errorlist">
                        {% for error in errors %}
                        <li><strong class="text-danger">{{ error|escape }}</strong></li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    <!-- {{form}} -->
                </div>
                <h4 class="card-title">Fecha y hora</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card ">
                            <div class="card-header card-header-rose card-header-text">
                                <div class="card-icon">
                                    <i class="material-icons">library_books</i>
                                </div>
                                <h4 class="card-title">Fecha</h4>
                            </div>
                            <div class="card-body ">
                                <div class="form-group">
                                    <input type="date" class="form-control datepicker" name="date" id="id_date"
                                        {% if current_date %} value="{{current_date}}" {% endif %} placeholder=""
                                        readonly>
                                    {% if form.date.help_text %}
                                    <p class="help">{{ form.date.help_text|safe }}</p>
                                    {% endif %}
                                    {% if form.date.errors %}
                                    <ul class="errorlist">
                                        {% for error in form.date.errors %}
                                        <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                        {% endfor %}
                                    </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card ">
                            <div class="card-header card-header-rose card-header-text">
                                <div class="card-icon">
                                    <i class="material-icons">av_timer</i>
                                </div>
                                <h4 class="card-title">Hora</h4>
                            </div>
                            <div class="card-body ">
                                <div class="form-group">
                                    <input type="time" class="form-control timepicker" name="time" id="id_time"
                                        {% if form.time.value %} value="{{form.time.value}}" {% endif %} placeholder=""
                                        required>
                                    {% if form.time.help_text %}
                                    <p class="help">{{ form.time.help_text|safe }}</p>
                                    {% endif %}
                                    {% if form.time.errors %}
                                    <ul class="errorlist">
                                        {% for error in form.time.errors %}
                                        <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                        {% endfor %}
                                    </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body ">
                <h4 class="card-title">Horas consumidas</h4>
                <div id="horas_consumidas_error">

                </div>
                <div class="row">
                    <label class="col-sm-3 col-form-label">Horas de Maquina</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <input type="number" class="form-control" name="machine_hours" id="id_machine_hours"
                                {% if form.machine_hours.value %} value="{{form.machine_hours.value}}" {% endif %}
                                placeholder="" step="1" >
                            {% if form.machine_hours.help_text %}
                            <p class="help">{{ form.machine_hours.help_text|safe }}</p>
                            {% endif %}
                            {% if form.machine_hours.erros %}
                            <ul class="errorlist">
                                {% for error in form.machine_hours.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    <label class="col-sm-3 col-form-label">Horas de Tripulación</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <input type="number" class="form-control" name="crew_hours" id="id_crew_hours"
                                {% if form.crew_hours.value %} value="{{form.crew_hours.value}}" {% endif %}
                                placeholder="" step="1" >
                            {% if form.crew_hours.help_text %}
                            <p class="help">{{ form.crew_hours.help_text|safe }}</p>
                            {% endif %}
                            {% if form.crew_hours.erros %}
                            <ul class="errorlist">
                                {% for error in form.crew_hours.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <h4 class="card-title">Ubicación</h4>
                <div class="row">
                    <label class="col-sm-3 col-form-label">Departamento</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition" title="Elegir Departamento"
                                data-size="7" name="department" id="id_department" required>
                                {% for dep in departments %}
                                <option value="{{ dep.pk }}" {% if dep.pk == department_id %} selected{% endif %}>
                                    {{ dep.name }}
                                </option>
                                {% endfor %}
                            </select>
                            {% if form.department.help_text %}
                            <p class="help">{{ form.department.help_text|safe }}</p>
                            {% endif %}
                            {% if form.department.errors %}
                            <ul class="errorlist">
                                {% for error in form.department.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    <label class="col-sm-2 col-form-label">Municipio</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition" title="Elegir Municipio"
                                data-size="7" name="municipality" id="id_municipality" required>
                            </select>
                            {% if form.municipality.help_text %}
                            <p class="help">{{ form.municipality.help_text|safe }}</p>
                            {% endif %}
                            {% if form.municipality.errors %}
                            <ul class="errorlist">
                                {% for error in form.municipality.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="row">
                    <label class="col-sm-3 col-form-label">Ruta</label>
                    <div class="col-sm-9">
                        <div class="form-group">
                            <input type="text" class="form-control" name="route" id="id_route" {% if form.route.value %}
                                value="{{form.route.value}}" {% endif %} placeholder="" required>
                            {% if form.route.help_text %}
                            <p class="help">{{ form.route.help_text|safe }}</p>
                            {% endif %}
                            {% if form.route.erros %}
                            <ul class="errorlist">
                                {% for error in form.route.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <h4 class="card-title">Carga de la aeronave</h4>
                <div class="row">
                    <label class="col-sm-3 col-form-label">PAX</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <input type="number" class="form-control" name="pax" id="id_pax" {% if form.pax.value %}
                                value="{{form.pax.value}}" {% endif %} placeholder="" step="1" >
                            {% if form.pax.help_text %}
                            <p class="help">{{ form.pax.help_text|safe }}</p>
                            {% endif %}
                            {% if form.pax.erros %}
                            <ul class="errorlist">
                                {% for error in form.pax.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    <label class="col-sm-3 col-form-label">Evacuaciones Civiles</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <input type="number" class="form-control" name="civil_evacuations" id="id_civil_evacuations"
                                {% if form.civil_evacuations.value %} value="{{form.civil_evacuations.value}}"
                                {% endif %} placeholder="" step="1" >
                            {% if form.civil_evacuations.help_text %}
                            <p class="help">{{ form.civil_evacuations.help_text|safe }}</p>
                            {% endif %}
                            {% if form.civil_evacuations.erros %}
                            <ul class="errorlist">
                                {% for error in form.civil_evacuations.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="row">
                    <label class="col-sm-3 col-form-label">Kilos</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <input type="number" class="form-control" name="kilos" id="id_kilos"
                                {% if form.kilos.value %} value="{{form.kilos.value}}" {% endif %} placeholder=""
                                step="0.1" >
                            {% if form.kilos.help_text %}
                            <p class="help">{{ form.kilos.help_text|safe }}</p>
                            {% endif %}
                            {% if form.kilos.erros %}
                            <ul class="errorlist">
                                {% for error in form.kilos.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    <label class="col-sm-3 col-form-label">Combustible</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <input type="number" class="form-control" name="fuel" id="id_fuel" {% if form.fuel.value %}
                                value="{{form.fuel.value}}" {% endif %} placeholder="" >
                            {% if form.fuel.help_text %}
                            <p class="help">{{ form.fuel.help_text|safe }}</p>
                            {% endif %}
                            {% if form.fuel.erros %}
                            <ul class="errorlist">
                                {% for error in form.fuel.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <p class="card-title">Propias tropas</p>
                <div class="row">
                    <label class="col-sm-2 col-form-label">Heridos</label>
                    <div class="col-sm-2">
                        <div class="form-group">
                            <input type="number" class="form-control" name="wounded_pt" id="id_wounded_pt"
                                {% if form.wounded_pt.value %} value="{{form.wounded_pt.value}}" {% endif %}
                                placeholder="" step="1" >
                            {% if form.wounded_pt.help_text %}
                            <p class="help">{{ form.wounded_pt.help_text|safe }}</p>
                            {% endif %}
                            {% if form.wounded_pt.erros %}
                            <ul class="errorlist">
                                {% for error in form.wounded_pt.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    <label class="col-sm-2 col-form-label">Enfermos</label>
                    <div class="col-sm-2">
                        <div class="form-group">
                            <input type="number" class="form-control" name="sick_pt" id="id_sick_pt"
                                {% if form.sick_pt.value %} value="{{form.sick_pt.value}}" {% endif %} placeholder=""
                                step="1" >
                            {% if form.sick_pt.help_text %}
                            <p class="help">{{ form.sick_pt.help_text|safe }}</p>
                            {% endif %}
                            {% if form.sick_pt.erros %}
                            <ul class="errorlist">
                                {% for error in form.sick_pt.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    <label class="col-sm-2 col-form-label">Muertos</label>
                    <div class="col-sm-2">
                        <div class="form-group">
                            <input type="number" class="form-control" name="dead_pt" id="id_dead_pt"
                                {% if form.dead_pt.value %} value="{{form.dead_pt.value}}" {% endif %} placeholder=""
                                step="1" >
                            {% if form.dead_pt.help_text %}
                            <p class="help">{{ form.dead_pt.help_text|safe }}</p>
                            {% endif %}
                            {% if form.dead_pt.erros %}
                            <ul class="errorlist">
                                {% for error in form.dead_pt.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <p class="card-title">Enemigo</p>
                <div class="row">
                    <label class="col-sm-2 col-form-label">Heridos</label>
                    <div class="col-sm-2">
                        <div class="form-group">
                            <input type="number" class="form-control" name="wounded_en" id="id_wounded_en"
                                {% if form.wounded_en.value %} value="{{form.wounded_en.value}}" {% endif %}
                                placeholder="" step="1" >
                            {% if form.wounded_en.help_text %}
                            <p class="help">{{ form.wounded_en.help_text|safe }}</p>
                            {% endif %}
                            {% if form.wounded_en.erros %}
                            <ul class="errorlist">
                                {% for error in form.wounded_en.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    <label class="col-sm-2 col-form-label">Enfermos</label>
                    <div class="col-sm-2">
                        <div class="form-group">
                            <input type="number" class="form-control" name="sick_en" id="id_sick_en"
                                {% if form.sick_en.value %} value="{{form.sick_en.value}}" {% endif %} placeholder=""
                                step="1" >
                            {% if form.sick_en.help_text %}
                            <p class="help">{{ form.sick_en.help_text|safe }}</p>
                            {% endif %}
                            {% if form.sick_en.erros %}
                            <ul class="errorlist">
                                {% for error in form.sick_en.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    <label class="col-sm-2 col-form-label">Muertos</label>
                    <div class="col-sm-2">
                        <div class="form-group">
                            <input type="number" class="form-control" name="dead_en" id="id_dead_en"
                                {% if form.dead_en.value %} value="{{form.dead_en.value}}" {% endif %} placeholder=""
                                step="1" >
                            {% if form.dead_en.help_text %}
                            <p class="help">{{ form.dead_en.help_text|safe }}</p>
                            {% endif %}
                            {% if form.dead_en.erros %}
                            <ul class="errorlist">
                                {% for error in form.dead_en.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header card-header-rose card-header-icon">
                <div class="card-icon">
                    <i class="material-icons">&#xE905;</i>
                </div>
                <div class="card-text">
                    <h4 class="card-title">Unidades</h4>
                </div>
            </div>
            <div class="card-body ">
                <h4 class="card-title">Unidades</h4>
                <div class="row">
                    <label class="col-sm-3 col-form-label">Unidad de aviación</label>
                    <div class="col-sm-9">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition"
                                title="Elegir Unidad de aviación" data-size="7" name="aviation_unit"
                                id="id_aviation_unit" required {% if aviation_unit %} readonly {% endif %}>
                                {% if aviation_unit %}
                                <option value="{{aviation_unit.pk}}" selected>
                                    {{aviation_unit.abbreviation}} - {{aviation_unit.name}}
                                </option>
                                {% else %}
                                {% for avunit in aviation_units %}
                                <option value="{{ avunit.pk }}">
                                    {{ avunit.abbreviation }} - {{avunit.name}}
                                </option>
                                {% endfor %}
                                {% endif %}
                            </select>
                        </div>
                    </div>
                </div>
                <h4 class="card-title">Unidad apoyada</h4>
                <div class="row">
                    <label class="col-sm-3 col-form-label">Unidad Operativa Mayor</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition" title="Elegir Unidad"
                                data-size="7" name="major_operative_unit" id="id_major_operative_unit">
                                {% for x,y in form.fields.major_operative_unit.choices %}
                                <option value="{{ x }}" {% if form.major_operative_unit.value == x %}
                                    selected{% endif %}>
                                    {{ y }}
                                </option>
                                {% endfor %}
                            </select>
                            {% if form.major_operative_unit.help_text %}
                            <p class="help">{{ form.major_operative_unit.help_text|safe }}</p>
                            {% endif %}
                            {% if form.major_operative_unit.errors %}
                            <ul class="errorlist">
                                {% for error in form.major_operative_unit.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    <label class="col-sm-2 col-form-label">Unidad Operativa Menor</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition" title="Elegir Unidad"
                                data-size="7" name="minor_operative_unit" id="id_minor_operative_unit">
                                {% for x,y in form.fields.minor_operative_unit.choices %}
                                <option value="{{ x }}" {% if form.minor_operative_unit.value == x %}
                                    selected{% endif %}>
                                    {{ y }}
                                </option>
                                {% endfor %}
                            </select>
                            {% if form.minor_operative_unit.help_text %}
                            <p class="help">{{ form.minor_operative_unit.help_text|safe }}</p>
                            {% endif %}
                            {% if form.minor_operative_unit.errors %}
                            <ul class="errorlist">
                                {% for error in form.minor_operative_unit.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    <label class="col-sm-3 col-form-label">Unidad táctica</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition"
                                title="Elegir Unidad táctica" data-size="7" name="tactic_unit" id="id_tactic_unit">
                                {% for x,y in form.fields.tactic_unit.choices %}
                                <option value="{{ x }}" {% if form.tactic_unit.value == x %} selected{% endif %}>
                                    {{ y }}
                                </option>
                                {% endfor %}
                            </select>
                            {% if form.tactic_unit.help_text %}
                            <p class="help">{{ form.tactic_unit.help_text|safe }}</p>
                            {% endif %}
                            {% if form.tactic_unit.errors %}
                            <ul class="errorlist">
                                {% for error in form.tactic_unit.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    <label class="col-sm-2 col-form-label">Convenio</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition" title="Elegir Convenio"
                                data-size="7" name="agreement" id="id_agreement">
                                {% for x,y in form.fields.agreement.choices %}
                                <option value="{{ x }}" {% if form.agreement.value == x %} selected{% endif %}>
                                    {{ y }}
                                </option>
                                {% endfor %}
                            </select>
                            {% if form.agreement.help_text %}
                            <p class="help">{{ form.agreement.help_text|safe }}</p>
                            {% endif %}
                            {% if form.agreement.errors %}
                            <ul class="errorlist">
                                {% for error in form.agreement.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header card-header-rose card-header-icon">
                <div class="card-icon">
                    <i class="material-icons">&#xE905;</i>
                </div>
                <div class="card-text">
                    <h4 class="card-title">Configuración</h4>
                </div>
            </div>
            <div class="card-body ">
                <h4 class="card-title">Aeronave</h4>
                <div class="row">
                    <label class="col-sm-3 col-form-label">Tipo / Flota de aeronave</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition"
                                title="Elegir Flota Aeronave" data-size="7" name="aircraft_type" id="id_aircraft_type"
                                required>
                                {% for aircraft_type in aircraft_types %}
                                <option value="{{ aircraft_type.pk }}" {% if aircraft_type.pk == aircraft_type_id %}
                                    selected{% endif %}>
                                    {{ aircraft_type.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <label class="col-sm-3 col-form-label">Modelo de aeronave</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition"
                                title="Elegir Modelo Aeronave" data-size="7" name="aircraft_model"
                                id="id_aircraft_model" required>
                            </select>
                        </div>
                    </div>
                    <label class="col-sm-3 col-form-label">Aeronave</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition" title="Elegir Aeronave"
                                data-size="7" name="aircraft" id="id_aircraft">
                            </select>
                            {% if form.aircraft.help_text %}
                            <p class="help">{{ form.aircraft.help_text|safe }}</p>
                            {% endif %}
                            {% if form.aircraft.errors %}
                            <ul class="errorlist">
                                {% for error in form.aircraft.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    <label class="col-sm-3 col-form-label">Orden de Vuelo</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <input type="text" class="form-control" name="flight_order_id" id="id_flight_order_id"
                                {% if form.flight_order_id.value %} value="{{flight_order_id.value}}" {% endif %}
                                placeholder="" required>
                            {% if form.flight_order_id.help_text %}
                            <p class="help">{{ form.flight_order_id.help_text|safe }}</p>
                            {% endif %}
                            {% if form.flight_order_id.erros %}
                            <ul class="errorlist">
                                {% for error in form.flight_order_id.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <h4 class="card-title">Misiones de aviación</h4>
                <div class="row">
                    <label class="col-sm-3 col-form-label">Tipo de misión</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition"
                                title="Elegir Tipo de misión" data-size="7" name="mission_type" id="id_mission_type"
                                required>
                                {% for mission_type in mission_types %}
                                <option value="{{ mission_type.pk }}" {% if mission_type.pk == mission_type_id %}
                                    selected{% endif %}>
                                    {{ mission_type.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <label class="col-sm-3 col-form-label">Misión de Aviación</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition" title="Elegir Misión"
                                data-size="7" name="aviation_mission" id="id_aviation_mission">
                            </select>
                            {% if form.aviation_mission.help_text %}
                            <p class="help">{{ form.aviation_mission.help_text|safe }}</p>
                            {% endif %}
                            {% if form.aviation_mission.errors %}
                            <ul class="errorlist">
                                {% for error in form.aviation_mission.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    <label class="col-sm-3 col-form-label">Configuración</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition"
                                title="Elegir Configuración" data-size="7" name="configuration" id="id_configuration">
                                {% for x,y in form.fields.configuration.choices %}
                                <option value="{{ x }}" {% if form.configuration.value == x %} selected{% endif %}>
                                    {{ y }}
                                </option>
                                {% endfor %}
                            </select>
                            {% if form.configuration.help_text %}
                            <p class="help">{{ form.configuration.help_text|safe }}</p>
                            {% endif %}
                            {% if form.configuration.errors %}
                            <ul class="errorlist">
                                {% for error in form.configuration.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="row">
                    <label class="col-sm-3 col-form-label">Condiciones de Vuelo</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition" title="Elegir Evento"
                                data-size="7" name="flight_conditions" id="id_flight_conditions">
                                {% for x,y in form.fields.flight_conditions.choices %}
                                <option value="{{ x }}" {% if form.flight_conditions.value == x %} selected{% endif %}>
                                    {{ y }}
                                </option>
                                {% endfor %}
                            </select>
                            {% if form.flight_conditions.help_text %}
                            <p class="help">{{ form.flight_conditions.help_text|safe }}</p>
                            {% endif %}
                            {% if form.flight_conditions.errors %}
                            <ul class="errorlist">
                                {% for error in form.flight_conditions.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <h4 class="card-title">Operación</h4>
                <div class="row">
                    <label class="col-sm-3 col-form-label">Operación mayor</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition"
                                title="Elegir Operación Mayor" data-size="7" name="major_operation"
                                id="id_major_operation" required>
                                {% for major_operation in major_operations %}
                                <option value="{{ major_operation.pk }}"
                                    {% if major_operation.pk == major_operation_id %} selected{% endif %}>
                                    {{ major_operation.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <label class="col-sm-3 col-form-label">Operación</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition" title="Elegir Operación"
                                data-size="7" name="operation" id="id_operation">
                            </select>
                            {% if form.operation.help_text %}
                            <p class="help">{{ form.operation.help_text|safe }}</p>
                            {% endif %}
                            {% if form.operation.errors %}
                            <ul class="errorlist">
                                {% for error in form.operation.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <h4 class="card-title">Tripulación</h4>
                <div id="crew-form">
                    <p class="card-title text-danger">Selecciona una aeronave</p>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header card-header-rose card-header-icon">
                <div class="card-icon">
                    <i class="material-icons">&#xE905;</i>
                </div>
                <div class="card-text">
                    <h4 class="card-title">Información adicional</h4>
                </div>
            </div>
            <div class="card-body ">
                <h4 class="card-title">Eventos de aviación</h4>
                <div class="row">
                    <label class="col-sm-3 col-form-label">Evento de Aviación</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition" title="Elegir Evento"
                                data-size="7" name="aviation_event" id="id_aviation_event">
                                {% for x,y in form.fields.aviation_event.choices %}
                                <option value="{{ x }}" {% if form.aviation_event.value == x %} selected{% endif %}>
                                    {{ y }}
                                </option>
                                {% endfor %}
                            </select>
                            {% if form.aviation_event.help_text %}
                            <p class="help">{{ form.aviation_event.help_text|safe }}</p>
                            {% endif %}
                            {% if form.aviation_event.errors %}
                            <ul class="errorlist">
                                {% for error in form.aviation_event.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <h4 class="card-title">Clasificación de riesgo</h4>
                <div class="row">
                    <label class="col-sm-3 col-form-label">Clasificación de riesgo</label>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <select class="selectpicker" data-style="select-with-transition" title="Elegir Evento"
                                data-size="7" name="risk_classification" id="id_risk_classification">
                                {% for x,y in form.fields.risk_classification.choices %}
                                <option value="{{ x }}" {% if form.risk_classification.value == x %}
                                    selected{% endif %}>
                                    {{ y }}
                                </option>
                                {% endfor %}
                            </select>
                            {% if form.risk_classification.help_text %}
                            <p class="help">{{ form.risk_classification.help_text|safe }}</p>
                            {% endif %}
                            {% if form.risk_classification.errors %}
                            <ul class="errorlist">
                                {% for error in form.risk_classification.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <h4 class="card-title">Observaciones</h4>
                <div class="row">
                    <label class="col-sm-2 col-form-label">Observaciones</label>
                    <div class="col-sm-9">
                        <div class="form-group">
                            <input type="text" class="form-control" name="observations" id="id_observations"
                                {% if form.observations.value %} value="{{form.observations.value}}" {% endif %}
                                placeholder="" >
                            {% if form.observations.help_text %}
                            <p class="help">{{ form.observations.help_text|safe }}</p>
                            {% endif %}
                            {% if form.observations.erros %}
                            <ul class="errorlist">
                                {% for error in form.observations.errors %}
                                <li><strong class="text-danger">{{ error|escape }}</strong></li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12 text-center">
            <button type="submit" class="btn btn-rose">Guardar</button>
        </div>
    </form>
</div>



{% endblock content %}
{% block js %}
<script type="text/javascript">
    $(document).ready(function () {
        $("#id_department").on("change", getMunicipalities);
        $("#id_agreement").on("change", changeUnits);
        $("#id_aircraft_type").on("change", getAircraftModels);
        $("#id_aircraft_model").on("change", getAircrafts);
        $("#id_mission_type").on("change", getAviationMissions);
        $("#id_major_operation").on("change", getOperations);
        $("#id_minor_operative_unit").on("change", getTactic);
        


        $("#flight_report_form").submit(function (e) {
            e.preventDefault(e);
            var machine_hours = parseInt($("#id_machine_hours").val());
            var crew_hours = parseInt($("#id_crew_hours").val());

            if (crew_hours > machine_hours) {
                document.getElementById("flight_report_form").submit();
            } else {
                $("#horas_consumidas_error").html('<ul class="errorlist"><li><strong class="text-danger">Las horas de Tripulación deben ser mayores que las de la máquina.</strong></li></ul>');
                window.location.hash = '#horas_consumidas_error';
            }
        });
    });

    function changeUnits() {
        $("#id_major_operative_unit").val('default').selectpicker("refresh");
        $("#id_minor_operative_unit").val('default').selectpicker("refresh");
        $("#id_tactic_unit").val('default').selectpicker("refresh");
    }

    function getMunicipalities() {
        var departmentId = $("#id_department").val();
        if (departmentId) {
            // Eliminamos las opciones anteriores del select
            $("#id_municipality").html("");
            $("#id_municipality").selectpicker("refresh");
            var request = $.ajax({
                type: "GET",
                url: "{% url 'index:ajax_municipalities' %}",
                data: {
                    "id_department": departmentId,
                },
            });
            request.done(function (response) {
                console.log(response);
                // Agregamos los resultados al select
                $("#id_municipality").html(response.municipalities);
                $("#id_municipality").selectpicker("refresh");
            });
        } else {
            $("#id_municipality").html("<option value='' selected='selected'>---------</option>");
            $("#id_municipality").selectpicker("refresh");
        }
    }
    
    function getTactic() {
        var minor_operative_unitId = $("#id_minor_operative_unit").val();
        if (minor_operative_unitId) {
            // Eliminamos las opciones anteriores del select
            $("#id_tactic_unit").html("");
            $("#id_tactic_unit").selectpicker("refresh");
            var request = $.ajax({
                type: "GET",
                url: "{% url 'index:ajax_get_tactic_units' %}",
                data: {
                    "id_minor_operative_unit": minor_operative_unitId,
                },
            });
            request.done(function (response) {
                console.log(response);
                // Agregamos los resultados al select
                $("#id_tactic_unit").html(response.tactic_units);
                $("#id_tactic_unit").selectpicker("refresh");
            });
        } else {
            $("#id_tactic_unit").html("<option value='' selected='selected'>---------</option>");
            $("#id_tactic_unit").selectpicker("refresh");
        }
    }

    function getAircraftModels() {
        var aircraftTypeId = $("#id_aircraft_type").val();
        if (aircraftTypeId) {
            // Eliminamos las opciones anteriores del select
            $("#id_aircraft_model").html("");
            $("#id_aircraft_model").selectpicker("refresh");
            var request = $.ajax({
                type: "GET",
                url: "{% url 'index:ajax_aircraft_models' %}",
                data: {
                    "id_aircraft_type": aircraftTypeId,
                },
            });
            request.done(function (response) {
                console.log(response);
                // Agregamos los resultados al select
                $("#id_aircraft_model").html(response.aircraft_models);
                $("#id_aircraft_model").selectpicker("refresh");
            });
        } else {
            $("#id_aircraft_model").html("<option value='' selected='selected'>---------</option>");
            $("#id_aircraft_model").selectpicker("refresh");
        }
    }

    function getAircrafts() {
        var aircraftModelId = $("#id_aircraft_model").val();
        if (aircraftModelId) {
            // Eliminamos las opciones anteriores del select
            $("#id_aircraft").html("");
            $("#id_aircraft").selectpicker("refresh");
            var request = $.ajax({
                type: "GET",
                url: "{% url 'index:ajax_aircrafts' %}",
                data: {
                    "id_aircraft_model": aircraftModelId,
                },
            });
            request.done(function (response) {
                console.log(response);
                // Agregamos los resultados al select
                $("#id_aircraft").html(response.aircrafts);
                $("#id_aircraft").selectpicker("refresh");
            });
        } else {
            $("#id_aircraft").html("<option value='' selected='selected'>---------</option>");
            $("#id_aircraft").selectpicker("refresh");
        }
    }

    function getAviationMissions() {
        var missionTypeId = $("#id_mission_type").val();
        if (missionTypeId) {
            // Eliminamos las opciones anteriores del select
            $("#id_aviation_mission").html("");
            $("#id_aviation_mission").selectpicker("refresh");
            var request = $.ajax({
                type: "GET",
                url: "{% url 'index:ajax_aviation_missions' %}",
                data: {
                    "id_mission_type": missionTypeId,
                },
            });
            request.done(function (response) {
                console.log(response);
                // Agregamos los resultados al select
                $("#id_aviation_mission").html(response.aviation_missions);
                $("#id_aviation_mission").selectpicker("refresh");
            });
        } else {
            $("#id_aviation_mission").html("<option value='' selected='selected'>---------</option>");
            $("#id_aviation_mission").selectpicker("refresh");
        }
    }

    function getOperations() {
        var majorOperationId = $("#id_major_operation").val();
        if (majorOperationId) {
            // Eliminamos las opciones anteriores del select
            $("#id_operation").html("");
            $("#id_operation").selectpicker("refresh");
            var request = $.ajax({
                type: "GET",
                url: "{% url 'index:ajax_operations' %}",
                data: {
                    "id_major_operation": majorOperationId,
                },
            });
            request.done(function (response) {
                console.log(response);
                // Agregamos los resultados al select
                $("#id_operation").html(response.operations);
                $("#id_operation").selectpicker("refresh");
            });
        } else {
            $("#id_operation").html("<option value='' selected='selected'>---------</option>");
            $("#id_operation").selectpicker("refresh");
        }
    }
    
</script>

<script type="text/javascript">
    function getCrew(select) {
        let id = $(select).children("option:selected").val();
        $.ajax({
            url: '/flight_report/get_crew/',
            type: 'GET',
            data: {
                aircraft_id: id
            }
        }).done(function (res) {
            $("#crew-form").html(res);
            $("#id_pam_crew").selectpicker("refresh");
            $("#id_p_crew").selectpicker("refresh");
            $("#id_iv_crew").selectpicker("refresh");
            $("#id_jt_crew").selectpicker("refresh");
            $("#id_tv_crew").selectpicker("refresh");
            $("#id_art_crew").selectpicker("refresh");
            $("#id_cma_crew").selectpicker("refresh");
            $("#id_omi_crew").selectpicker("refresh");
            $("#id_ove_crew").selectpicker("refresh");
        });
    }
    $(document).ready(function () {
        $("#id_major_operative_unit").on("change", getMinorOperativeUnits);
        $(document).on('change', '#id_aircraft', function (e) { getCrew(this) });
    });

    function getMinorOperativeUnits() {
        var major_operative_unitId = $("#id_major_operative_unit").val();
        if (major_operative_unitId) {
            // Eliminamos las opciones anteriores del select
            $("#id_minor_operative_unit").html("");
            $("#id_minor_operative_unit").selectpicker("refresh");
            var request = $.ajax({
                type: "GET",
                url: "{% url 'index:ajax_minor_operative_units' %}",
                data: {
                    "id_major_operative_unit": major_operative_unitId,
                },
            });
            request.done(function (response) {
                console.log(response);
                // Agregamos los resultados al select
                $("#id_minor_operative_unit").html(response.minor_operative_units);
                $("#id_minor_operative_unit").selectpicker("refresh");
            });
        } else {
            $("#id_minor_operative_unit").html("<option value='' selected='selected'>---------</option>");
            $("#id_minor_operative_unit").selectpicker("refresh");
        }
    }

</script>
{% endblock js %}